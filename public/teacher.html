<!doctype html>
<html lang="th">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Teacher Dashboard - Fingerprint Attendance</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <header>
        <div class="brand">
            <div class="logo">FA</div>
            <div>
                <h1>Fingerprint Attendance System</h1>
            </div>
        </div>

        <div class="header-right">
            <span id="user-display" class="muted"></span>
            <button class="btn secondary" id="btn-logout">Logout</button>
        </div>
    </header>
    <main>
        <div class="grid">
            <!-- left/main column -->
            <div>
                <!-- Teacher Dashboard -->
                <section id="teacher-dashboard" class="card" aria-labelledby="teacher-title">
                    <div class="row head">
                        <div>
                            <h2 id="teacher-title">Teacher Dashboard</h2>
                            <small class="muted">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</small>
                        </div>
                        <div id="live-badge" class="live-badge offline">
                            ‚ö™ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≤‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                        </div>

                        <div class="row actions">
                            <button class="btn" onclick="openAddSubject()">Create Subject</button>
                            <button class="btn" onclick="toggleManageStudents(true)">üë• Manage Students</button>

                            <button class="btn" onclick="openStartClass()">‚ñ∂Ô∏è Start Class</button>
                            <button class="btn danger" onclick="endClass()">‚õî End Class</button>

                        </div>
                    </div>



                    <!-- Live Attendance Panel (Refactored) -->
                    <div class="panel" id="live-attendance-panel"
                        style="display:none; border: none; box-shadow: none; background: transparent; padding: 0;">

                        <h3 style="margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                            üìä Live Attendance
                        </h3>

                        <!-- Session Info Bar -->
                        <div id="live-session-info"
                            style="background: #dcfce7; color: #166534; padding: 12px 16px; border-radius: 8px; margin-bottom: 16px; font-weight: 500;">
                            Loading session info...
                        </div>

                        <!-- Stats Grid -->
                        <div
                            style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 16px;">
                            <div class="stat-card gray">
                                <div class="stat-val" id="live-stat-total">0</div>
                                <div class="stat-label">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏•‡∏≤‡∏¢</div>
                            </div>
                            <div class="stat-card green">
                                <div class="stat-val" id="live-stat-ontime">0</div>
                                <div class="stat-label">‡∏°‡∏≤‡∏ï‡∏£‡∏á‡πÄ‡∏ß‡∏•‡∏≤</div>
                            </div>
                            <div class="stat-card yellow">
                                <div class="stat-val" id="live-stat-late">0</div>
                                <div class="stat-label">‡∏°‡∏≤‡∏™‡∏≤‡∏¢</div>
                            </div>
                            <div class="stat-card red"> <!-- Using red/gray for not scanned -->
                                <div class="stat-val" id="live-stat-absent">0</div>
                                <div class="stat-label">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡πÅ‡∏Å‡∏ô</div>
                            </div>
                        </div>

                        <!-- Table -->
                        <div class="card" style="padding: 0; overflow: hidden;">
                            <div id="live-attendance-table"></div>
                        </div>
                    </div>

                    <div class="panel">
                        <h3>Attendance by Subject</h3>
                        <div class="form-row">
                            <select id="teacher-subject-select"></select>
                            <select id="teacher-session-select" onchange="renderAttendanceBySession()">
                                <option value="">-- ‡∏£‡∏≠‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô --</option>
                            </select>

                            <button class="btn secondary" onclick="renderAttendanceBySession()">Filter</button>
                        </div>
                        <div id="attendance-table"></div>
                    </div>
                </section>

                <!-- Hidden View for Manage Students -->
                <section id="manage-students-view" class="card" style="display:none">
                    <div class="row head">
                        <div>
                            <h2>Manage Students</h2>
                            <small class="muted">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</small>
                        </div>
                        <button class="btn secondary" onclick="toggleManageStudents(false)">‚¨Ö Back to Dashboard</button>
                    </div>

                    <div class="panel">
                        <div class="form-row">
                            <input id="student-search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô..." oninput="renderStudents()">
                            <button class="btn" onclick="openAddStudent()">+ Add Student</button>
                        </div>
                        <div id="students-table"></div>
                    </div>
                </section>
            </div>

            <!-- right column -->
            <aside class="right-col">
                <div class="card">
                    <h3>Current/Preview</h3>

                    <div class="center-banner" title="preview image"></div>
                    <div class="session-card">
                        <div>
                            <div class="bold" id="preview-subject">‚Äî</div>
                            <div class="muted" id="preview-time">‚Äî</div>
                        </div>
                        <div style="text-align:right">
                            <div class="muted">Status</div>
                            <div class="chip" id="preview-status">Idle</div>
                        </div>
                    </div>
                </div>

                <!-- QUICK ACTIONS (teacher only) -->
                <div id="teacher-quick-actions" class="card">
                    <h3>Quick Actions</h3>
                    <div style="display:flex;flex-direction:column;gap:8px">
                        <button class="btn" onclick="openCreateSession()">Create Session</button>
                        <button class="btn" onclick="openAddStudent()">Add Student</button>
                        <button class="btn secondary" onclick="showEnrollmentGuide()">Enrollment Guide</button>
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <!-- modal -->
    <div class="modal-backdrop" id="modal-backdrop">
        <div class="modal" id="modal"></div>
    </div>

    <script src="app.js"></script>
</body>

</html>